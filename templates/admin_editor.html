<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä - {{ filename.replace('.json', '') }}</title>
    <link rel="stylesheet" href="/admin_static/admin_panel.css">
    <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="editor-container">
        <div class="editor-wrapper">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <aside class="editor-sidebar">
                <div class="sidebar-header">
                    <h3>üìÇ {{ filename.replace('.json', '') }}</h3>
                </div>
                
                <div class="sidebar-actions">
                    <a href="/admin/edit/{{ page }}/{{ filename }}/new" class="btn btn-success btn-block">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                    </a>
                </div>

                <div class="sidebar-list">
                    <ul class="items-list">
                        {% for item_idx, item in enumerate(data) %}
                            <li>
                                <a 
                                    href="/admin/edit/{{ page }}/{{ filename }}?id={{ item_idx }}"
                                    class="list-item {% if item_idx == idx %}active{% endif %}"
                                >
                                    {{ item.get('name') or item.get('title') or item.get('id') or '–ë–µ–∑ –∏–º–µ–Ω–∏' }}
                                </a>
                            </li>
                        {% else %}
                            <li class="empty-state">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="sidebar-footer">
                    <a href="/admin" class="btn btn-secondary btn-block">
                        ‚Üê –ù–∞–∑–∞–¥ –≤ —Ä–∞–∑–¥–µ–ª—ã
                    </a>
                </div>
            </aside>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <main class="editor-main">
                <div class="editor-header">
                    <h2>‚úçÔ∏è {% if idx == -1 or idx is none %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏{% else %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:  {{ item.get('name') or item.get('title') or item.get('id') or '–ë–µ–∑ –∏–º–µ–Ω–∏' }}{% endif %}</h2>
                    <div class="editor-meta">
                        <span class="meta-item">–§–∞–π–ª: {{ filename }}</span>
                        {% if idx != -1 and idx is not none %}
                            <span class="meta-item">ID –∑–∞–ø–∏—Å–∏: {{ item.get('id') or idx }}</span>
                        {% endif %}
                    </div>
                </div>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert {% if category == 'success' %}alert-success{% else %}alert-error{% endif %}">
                                <p>{{ message }}</p>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" class="editor-form" action="/admin/edit/{{ page }}/{{ filename }}{% if idx != -1 %}?id={{ idx }}{% endif %}">
                    <input type="hidden" name="index" value="{{ idx if idx is not none else -1 }}">

                    <!-- –û–±—â–∏–µ –ø–æ–ª—è -->
                    <div class="form-section">
                        <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                        {% if page == 'guides' %}
                            <!-- –ì–ê–ô–î–´ -->
                            <div class="form-group">
                                <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∞–π–¥–∞:</label>
                                <input type="text" id="title" name="title" value="{{ item.get('title', '') }}" required>
                            </div>

                            <div class="form-group">
                                <label for="source">–ò—Å—Ç–æ—á–Ω–∏–∫ (—Å—Å—ã–ª–∫–∞ YouTube –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É):</label>
                                <input type="text" id="source" name="source" value="{{ item.get('source', '') }}" 
                                    placeholder="https://www.youtube.com/watch?v=...  –∏–ª–∏ /static/img/guides/guide.jpg" required>
                            </div>

                            <div class="form-group">
                                <label for="type">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</label>
                                <select id="type" name="type" required>
                                    <option value="image" {% if item.get('type') == 'image' %}selected{% endif %}>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                                    <option value="youtube" {% if item.get('type') == 'youtube' %}selected{% endif %}>YouTube –≤–∏–¥–µ–æ</option>
                                </select>
                            </div>

                        {% elif page == 'materials' %}
                            <!-- –ú–ê–¢–ï–†–ò–ê–õ–´ -->
                            <div class="form-group">
                                <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:</label>
                                <input type="text" id="title" name="title" value="{{ item.get('title', '') }}" required>
                            </div>

                            <div class="form-group">
                                <label for="image">–ò–º—è —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                                <input type="text" id="image" name="image" value="{{ item.get('image', '') }}" 
                                    placeholder="image.jpg (—Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ static/img/materials/)" required>
                            </div>

                            <div class="form-group">
                                <label for="tag">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                                <input type="text" id="tag" name="tag" value="{{ item.get('tag', '') }}" 
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–æ–æ—Ä—É–∂–µ–Ω–∏–µ, –ó–¥–∞–Ω–∏—è –∏ —Ç.–¥." required>
                            </div>

                            <div class="form-group">
                                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                                <textarea id="description" name="description" rows="6" 
                                        placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ç–µ—Ä–∏–∞–ª–µ">{{ item.get('description', '') }}</textarea>
                            </div>

                        {% else %}
                            <!-- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ª–∏—á–Ω–æ—Å—Ç–∏, —Å–æ–±—ã—Ç–∏—è -->
                            {% if 'organizations' in filename %}
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="created">–°–æ–∑–¥–∞–Ω–æ:</label>
                                        <input type="text" id="created" name="created" value="{{ item.get('created','') }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="closed">–ó–∞–∫—Ä—ã—Ç–æ:</label>
                                        <input type="text" id="closed" name="closed" value="{{ item.get('closed','') }}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="reason">–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:</label>
                                    <input type="text" id="reason" name="reason_for_closing" value="{{ item.get('reason_for_closing','') }}">
                                </div>
                                <div class="form-group">
                                    <label for="peak">–ü–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</label>
                                    <input type="number" id="peak" name="peak_members" value="{{ item.get('peak_members','') }}" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="leader">–õ–∏–¥–µ—Ä—ã:</label>
                                    <textarea id="leader" name="leader" rows="5">{% if item.get('leader') %}{% if item.get('leader') is string %}{{ item.get('leader') }}{% else %}{{ '\n'.join(item.get('leader', [])) }}{% endif %}{% endif %}</textarea>
                                </div>
                            {% elif 'personalities' in filename %}
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="created">–ü—Ä–∏—à—ë–ª:</label>
                                        <input type="text" id="created" name="created" value="{{ item.get('created','') }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="departed">–£—à—ë–ª:</label>
                                        <input type="text" id="departed" name="departed" value="{{ item.get('departed','') }}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="oldnicks">–°—Ç–∞—Ä—ã–µ –Ω–∏–∫–∏:</label>
                                    <input type="text" id="oldnicks" name="old_nicknames" value="{{ item.get('old_nicknames','') }}">
                                </div>
                            {% elif 'events' in filename %}
                                <div class="form-group">
                                    <label for="type">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:</label>
                                    <input type="text" id="type" name="event_type" value="{{ item.get('event_type','') }}">
                                </div>
                                <div class="form-group">
                                    <label for="date">–î–∞—Ç–∞ (–ø–µ—Ä–∏–æ–¥):</label>
                                    <input type="text" id="date" name="date" value="{{ item.get('date','') }}">
                                </div>
                            {% endif %}
                            <div class="form-group">
                                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ (Markdown):</label>
                                <textarea id="description" name="description" rows="10">{{ item.get('description','') }}</textarea>
                            </div>
                        {% endif %}
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success btn-lg">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                        <a href="/admin/edit/{{ page }}/{{ filename }}" class="btn btn-secondary">‚Üê –û—Ç–º–µ–Ω–∏—Ç—å</a>
                    </div>
                </form>

                <!-- –£–¥–∞–ª–µ–Ω–∏–µ -->
                {% if idx != -1 and idx is not none %}
                <div class="delete-section">
                    <h3>‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h3>
                    <form method="POST" action="/admin/delete/{{ page }}/{{ filename }}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!');">
                        <input type="hidden" name="index" value="{{ idx }}">
                        <button type="submit" class="btn btn-danger btn-lg">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    </form>
                </div>
                {% endif %}
            </main>
        </div>
    </div>

    <script>
        const form = document.querySelector('.editor-form');
        let formChanged = false;
        form.addEventListener('change', () => formChanged = true);
        form.addEventListener('submit', () => formChanged = false);
        window.addEventListener('beforeunload', (e) => {
            if(formChanged) {
                e.preventDefault();
                e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è!';
            }
        });
    </script>
</body>
</html>